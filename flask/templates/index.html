<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>HackTownUSA</title>

    <!-- Bootstrap -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/styles.css" rel="stylesheet">
    <script type="text/javascript" src="static/js/app.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    {% with messages = get_flashed_messages() %} {% if messages %}
    <ul class=flashes>
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %} {% endwith %}

    <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Lane8</a>
                <p class="navbar-text">lets get hacky</p>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="jumbotron">
                <h1>What the Hack is Going On in the United States</h1>
                <p>APIs, APIs, and more APIs</p>
                <form class="form-inline">
                    <select class="form-control" id='ideas'>
                        <option>Choose!</option>
                        <option>Star Wars</option>
                        <option>Obama</option>
                        <option>Trump</option>
                        <option>Adele</option>
                    </select>
                    <div class='btn-group'>
                        <button id="happy" type="button" class="btn btn-default">Happiness</button>
                        <button id="sadness" type="button" class="btn btn-default">Sadness</button>
                        <button id="both" type="button" class="btn btn-default">Both</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class ="col-md-4 col-md-push-8">
                    <div id="tweeter">
                        <ul>

                        </ul>
                    </div>
=                </div>
                <div class="col-md-8 col-md-pull-4">
                    <div id='map'></div>f
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <h3 class="text-center">Top 5</h3>
        <div id='topFive'></div>
    </div>

    <footer>
        <div class="container">

        <h4 class="text-center">Holla</h4>
        <p class="text-center">Copyright © two days of straight coding one October weekend in 2015</p>

        </div>
    </footer>

        <script type="text/javascript">
            /*global google*/
            var map, sad_heatmap, happy_heatmap;
            $SCRIPT_ROOT = {{request.script_root | tojson | safe}};

            function initMap() {
                "use strict";
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 4,
                    center: {
                        lat: 38.8833,
                        lng: -95.9833
                    },
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    disableDefaultUI: true,
                    scrollwheel: false,
                    zoomControl: false,
                    navigationControl: false,
                    mapTypeControl: false,
                    scaleControl: false,
                    draggable: false,
                    disableDoubleClickZoom: false
                });
                var happy_gradient = [
                    'rgba(255, 255, 255, 0)', //Transparent
                    'rgba(255, 255, 150, 1)',
                    'rgba(255, 255, 120, 1)',
                    'rgba(255, 255, 90, 1)',
                    'rgba(255, 255, 60, 1)',
                    'rgba(255, 255, 40, 1)',
                    'rgba(255, 255, 0, 1)'

                ]

                var sad_gradient = [
                    'rgba(255, 255, 255, 0)',
                    'rgba(255, 200, 200, 1)',
                    'rgba(255, 160, 100, 1)',
                    'rgba(255, 120, 60, 1)',
                    'rgba(255, 80, 40, 1)',
                    'rgba(255, 40, 20, 1)',
                    'rgba(255, 0, 0, 1)'
                ]

                $("select#ideas").change(function() {

                    var $value = $('#ideas option:selected').text();
                    $("#tweeter a").attr("href", "https://twitter.com/search?q=" + $value);
                    $('#tweeter ul').empty();
                    $.ajax({
                        url: $SCRIPT_ROOT + '/_tweet_calcs', //TO DO
                        type: 'GET',
                        dataType: 'json',
                        data: {
                            'query': $value
                        },
                        success: function(json) {
                            console.log(json);
                            var happy_array = [];
                            var sad_array = [];
                            $.each(json.result, function(i, item) {
                                var coordinates = new google.maps.LatLng(parseInt(item.lat), parseInt(item.lng));
                                if (item.wgt < 0) {
                                    var weightedLoc = {
                                        location: coordinates,
                                        weight: item.wgt * -100
                                    };
                                    sad_array.push(weightedLoc);
                                } else if (item.wgt > 0) {
                                    var weightedLoc = {
                                        location: coordinates,
                                        weight: item.wgt * 100
                                    };
                                    happy_array.push(weightedLoc);
                                }
                                $('#tweeter ul').append('<li><h2>' + item.name + '</h2><p>' + item.text + '<p></li>');
                            });



                            if(typeof sad_heatmap !== 'undefined' ){
                                sad_heatmap.setMap(null);
                            }

                            if(typeof happy_heatmap !== 'undefined' ){
                                happy_heatmap.setMap(null);
                            }

                            $("button#both").css("background-color", "#FFA500");
                            $("button#sadness").css("background-color", "#FFFFFF");
                            $("button#happy").css("background-color", "#FFFFFF");
                            
                            sad_heatmap = new google.maps.visualization.HeatmapLayer({
                                data: sad_array,
                                map: map,
                                radius: 100,
                                gradient: sad_gradient,
                                opacity: .5
                            });

                            happy_heatmap = new google.maps.visualization.HeatmapLayer({
                                data: happy_array,
                                map: map,
                                radius: 100,
                                gradient: happy_gradient,
                                opacity: .5
                            });

                        },
                        error: function(xhr, desc, err) {
                            console.log(xhr);
                            console.log("Details: " + desc + "\nError: " + err);
                        }
                    })
                });

                $("button#happy").click(function() {
                    if(typeof sad_heatmap !== 'undefined' ){
                        sad_heatmap.setMap(null);
                    }
                    if(typeof happy_heatmap !== 'undefined' ){
                        happy_heatmap.setMap(map);
                    }
                    $(this).css("background-color", "#FFF000");
                    $("button#sadness").css("background-color", "#FFFFFF");
                    $("button#both").css("background-color", "#FFFFFF");
                });
                $("button#sadness").click(function() {
                    if(typeof sad_heatmap !== 'undefined' ){
                        sad_heatmap.setMap(map);
                    }
                    if(typeof happy_heatmap !== 'undefined' ){
                        happy_heatmap.setMap(null);
                    }
                    $(this).css("background-color", "#FF0000");
                    $("button#happy").css("background-color", "#FFFFFF");
                    $("button#both").css("background-color", "#FFFFFF");
                });
                $("button#both").click(function() {
                    if(typeof sad_heatmap !== 'undefined' ){
                        sad_heatmap.setMap(map);
                    }
                    if(typeof happy_heatmap !== 'undefined' ){
                        happy_heatmap.setMap(map);
                    }
                    $(this).css("background-color", "#FFA500");
                    $("button#sadness").css("background-color", "#FFFFFF");
                    $("button#happy").css("background-color", "#FFFFFF");
                });
            }







    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=visualization&callback=initMap"></script>


</body>

</html>
